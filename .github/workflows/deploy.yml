name: Deploy to Production

# mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ or æ‰‹å‹•å®Ÿè¡Œã§èµ·å‹•
on:
  push:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        default: 'production'
        type: choice
        options:
          - production
          - staging

jobs:
  deploy-vercel:
    name: Deploy to Vercel
    runs-on: ubuntu-latest
    environment: ${{ github.event.inputs.environment || 'production' }}
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v5
    
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
    
    - name: ğŸ“¦ Install dependencies
      run: npm ci
    
    - name: ğŸ—ï¸ Build application
      run: npm run build
      env:
        NODE_ENV: production
    
    # Vercelãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆç’°å¢ƒå¤‰æ•°è¨­å®šå¾Œã«æœ‰åŠ¹åŒ–ï¼‰
    # - name: ğŸš€ Deploy to Vercel
    #   uses: amondnet/vercel-action@v25
    #   with:
    #     vercel-token: ${{ secrets.VERCEL_TOKEN }}
    #     vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
    #     vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
    #     vercel-args: '--prod'
    #     working-directory: ./
    
    - name: ğŸ“¢ Deployment notification
      if: always()
      run: |
        echo "ğŸ‰ Deployment to ${{ github.event.inputs.environment || 'production' }} completed!"
        echo "Status: ${{ job.status }}"
        echo "Commit: ${{ github.sha }}"
        echo "Author: ${{ github.actor }}"

  # Cloudflare Workersç”¨ï¼ˆå°†æ¥çš„ã«ï¼‰
  # deploy-cloudflare:
  #   name: Deploy to Cloudflare Workers
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v5
  #     - name: Deploy to Cloudflare Workers
  #       uses: cloudflare/wrangler-action@v3
  #       with:
  #         apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
  #         accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}